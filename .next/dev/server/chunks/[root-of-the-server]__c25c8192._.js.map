{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 46, "column": 0}, "map": {"version":3,"sources":["file:///Users/anushka_101/Desktop/queenhereitis/pastebin/lib/pasteUtils.js"],"sourcesContent":["import { kv } from '@vercel/kv';\n\nconst TEST_MODE = process.env.TEST_MODE === '1';\n\n// Helper function to get current time (respects TEST_MODE)\nexport function getCurrentTime() {\n  return Date.now();\n}\n\n// Helper function to get current time from request (for TEST_MODE)\nexport function getCurrentTimeFromRequest(req) {\n  if (TEST_MODE && req.headers['x-test-now-ms']) {\n    const testTime = parseInt(req.headers['x-test-now-ms'], 10);\n    if (!isNaN(testTime)) {\n      return testTime;\n    }\n  }\n  return getCurrentTime();\n}\n\n// Generate unique ID\nexport function generateId() {\n  return Math.random().toString(36).substring(2, 15) + \n         Math.random().toString(36).substring(2, 15);\n}\n\n// Escape HTML to prevent XSS\nexport function escapeHtml(text) {\n  const map = {\n    '&': '&amp;',\n    '<': '&lt;',\n    '>': '&gt;',\n    '\"': '&quot;',\n    \"'\": '&#039;'\n  };\n  return text.replace(/[&<>\"']/g, m => map[m]);\n}\n\n// Get paste from KV\nexport async function getPaste(id) {\n  const kvKey = `paste:${id}`;\n  const pasteJson = await kv.get(kvKey);\n  return pasteJson ? JSON.parse(pasteJson) : null;\n}\n\n// Save paste to KV\nexport async function savePaste(id, pasteData, ttlSeconds = null) {\n  const kvKey = `paste:${id}`;\n  if (ttlSeconds) {\n    await kv.setex(kvKey, ttlSeconds, JSON.stringify(pasteData));\n  } else {\n    await kv.set(kvKey, JSON.stringify(pasteData));\n  }\n}\n\n// Delete paste from KV\nexport async function deletePaste(id) {\n  const kvKey = `paste:${id}`;\n  await kv.del(kvKey);\n}\n\n// Check if paste is expired\nexport function isPasteExpired(paste, now) {\n  if (!paste.expiresAt) return false;\n  const expiryTime = new Date(paste.expiresAt).getTime();\n  return now >= expiryTime;\n}\n\n// Check if paste view limit exceeded\nexport function isViewLimitExceeded(paste) {\n  if (paste.maxViews === null) return false;\n  return paste.currentViews >= paste.maxViews;\n}\n\n// Increment paste views\nexport async function incrementPasteViews(id, paste, now) {\n  paste.currentViews = (paste.currentViews || 0) + 1;\n  \n  const remainingTTL = paste.expiresAt \n    ? Math.max(0, Math.floor((new Date(paste.expiresAt).getTime() - now) / 1000))\n    : null;\n  \n  if (remainingTTL && remainingTTL > 0) {\n    await kv.setex(`paste:${id}`, remainingTTL, JSON.stringify(paste));\n  } else {\n    await kv.set(`paste:${id}`, JSON.stringify(paste));\n  }\n  \n  return paste;\n}\n"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;AAAA;;AAEA,MAAM,YAAY,QAAQ,GAAG,CAAC,SAAS,KAAK;AAGrC,SAAS;IACd,OAAO,KAAK,GAAG;AACjB;AAGO,SAAS,0BAA0B,GAAG;IAC3C,IAAI,aAAa,IAAI,OAAO,CAAC,gBAAgB,EAAE;QAC7C,MAAM,WAAW,SAAS,IAAI,OAAO,CAAC,gBAAgB,EAAE;QACxD,IAAI,CAAC,MAAM,WAAW;YACpB,OAAO;QACT;IACF;IACA,OAAO;AACT;AAGO,SAAS;IACd,OAAO,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG,MACxC,KAAK,MAAM,GAAG,QAAQ,CAAC,IAAI,SAAS,CAAC,GAAG;AACjD;AAGO,SAAS,WAAW,IAAI;IAC7B,MAAM,MAAM;QACV,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;QACL,KAAK;IACP;IACA,OAAO,KAAK,OAAO,CAAC,YAAY,CAAA,IAAK,GAAG,CAAC,EAAE;AAC7C;AAGO,eAAe,SAAS,EAAE;IAC/B,MAAM,QAAQ,CAAC,MAAM,EAAE,IAAI;IAC3B,MAAM,YAAY,MAAM,mKAAE,CAAC,GAAG,CAAC;IAC/B,OAAO,YAAY,KAAK,KAAK,CAAC,aAAa;AAC7C;AAGO,eAAe,UAAU,EAAE,EAAE,SAAS,EAAE,aAAa,IAAI;IAC9D,MAAM,QAAQ,CAAC,MAAM,EAAE,IAAI;IAC3B,IAAI,YAAY;QACd,MAAM,mKAAE,CAAC,KAAK,CAAC,OAAO,YAAY,KAAK,SAAS,CAAC;IACnD,OAAO;QACL,MAAM,mKAAE,CAAC,GAAG,CAAC,OAAO,KAAK,SAAS,CAAC;IACrC;AACF;AAGO,eAAe,YAAY,EAAE;IAClC,MAAM,QAAQ,CAAC,MAAM,EAAE,IAAI;IAC3B,MAAM,mKAAE,CAAC,GAAG,CAAC;AACf;AAGO,SAAS,eAAe,KAAK,EAAE,GAAG;IACvC,IAAI,CAAC,MAAM,SAAS,EAAE,OAAO;IAC7B,MAAM,aAAa,IAAI,KAAK,MAAM,SAAS,EAAE,OAAO;IACpD,OAAO,OAAO;AAChB;AAGO,SAAS,oBAAoB,KAAK;IACvC,IAAI,MAAM,QAAQ,KAAK,MAAM,OAAO;IACpC,OAAO,MAAM,YAAY,IAAI,MAAM,QAAQ;AAC7C;AAGO,eAAe,oBAAoB,EAAE,EAAE,KAAK,EAAE,GAAG;IACtD,MAAM,YAAY,GAAG,CAAC,MAAM,YAAY,IAAI,CAAC,IAAI;IAEjD,MAAM,eAAe,MAAM,SAAS,GAChC,KAAK,GAAG,CAAC,GAAG,KAAK,KAAK,CAAC,CAAC,IAAI,KAAK,MAAM,SAAS,EAAE,OAAO,KAAK,GAAG,IAAI,SACrE;IAEJ,IAAI,gBAAgB,eAAe,GAAG;QACpC,MAAM,mKAAE,CAAC,KAAK,CAAC,CAAC,MAAM,EAAE,IAAI,EAAE,cAAc,KAAK,SAAS,CAAC;IAC7D,OAAO;QACL,MAAM,mKAAE,CAAC,GAAG,CAAC,CAAC,MAAM,EAAE,IAAI,EAAE,KAAK,SAAS,CAAC;IAC7C;IAEA,OAAO;AACT"}},
    {"offset": {"line": 136, "column": 0}, "map": {"version":3,"sources":["file:///Users/anushka_101/Desktop/queenhereitis/pastebin/app/api/pastes/route.js"],"sourcesContent":["import { generateId, getCurrentTime } from '../../../lib/pasteUtils';\nimport { savePaste } from '../../../lib/pasteUtils';\n\nexport async function POST(request) {\n  try {\n    const body = await request.json();\n    const { content, ttl_seconds, max_views } = body;\n\n    // Validation\n    if (!content || typeof content !== 'string' || content.trim().length === 0) {\n      return Response.json(\n        { error: 'content is required and must be a non-empty string' },\n        { status: 400 }\n      );\n    }\n\n    if (ttl_seconds !== undefined) {\n      if (!Number.isInteger(ttl_seconds) || ttl_seconds < 1) {\n        return Response.json(\n          { error: 'ttl_seconds must be an integer >= 1' },\n          { status: 400 }\n        );\n      }\n    }\n\n    if (max_views !== undefined) {\n      if (!Number.isInteger(max_views) || max_views < 1) {\n        return Response.json(\n          { error: 'max_views must be an integer >= 1' },\n          { status: 400 }\n        );\n      }\n    }\n\n    // Generate ID and URL\n    const id = generateId();\n    const headers = Object.fromEntries(request.headers.entries());\n    const baseUrl = process.env.BASE_URL || \n                   (headers['x-forwarded-proto'] || 'http') + '://' + headers.host ||\n                   'http://localhost:3000';\n    const url = `${baseUrl}/p/${id}`;\n\n    // Calculate expiry time\n    const now = getCurrentTime();\n    const expiresAt = ttl_seconds \n      ? new Date(now + ttl_seconds * 1000).toISOString()\n      : null;\n\n    // Store paste data\n    const pasteData = {\n      content: content.trim(),\n      createdAt: now,\n      expiresAt,\n      maxViews: max_views || null,\n      currentViews: 0\n    };\n\n    // Store in KV\n    await savePaste(id, pasteData, ttl_seconds);\n\n    return Response.json({ id, url }, { status: 201 });\n  } catch (error) {\n    console.error('Error creating paste:', error);\n    return Response.json(\n      { error: 'Internal server error' },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;;;AAGO,eAAe,KAAK,OAAO;IAChC,IAAI;QACF,MAAM,OAAO,MAAM,QAAQ,IAAI;QAC/B,MAAM,EAAE,OAAO,EAAE,WAAW,EAAE,SAAS,EAAE,GAAG;QAE5C,aAAa;QACb,IAAI,CAAC,WAAW,OAAO,YAAY,YAAY,QAAQ,IAAI,GAAG,MAAM,KAAK,GAAG;YAC1E,OAAO,SAAS,IAAI,CAClB;gBAAE,OAAO;YAAqD,GAC9D;gBAAE,QAAQ;YAAI;QAElB;QAEA,IAAI,gBAAgB,WAAW;YAC7B,IAAI,CAAC,OAAO,SAAS,CAAC,gBAAgB,cAAc,GAAG;gBACrD,OAAO,SAAS,IAAI,CAClB;oBAAE,OAAO;gBAAsC,GAC/C;oBAAE,QAAQ;gBAAI;YAElB;QACF;QAEA,IAAI,cAAc,WAAW;YAC3B,IAAI,CAAC,OAAO,SAAS,CAAC,cAAc,YAAY,GAAG;gBACjD,OAAO,SAAS,IAAI,CAClB;oBAAE,OAAO;gBAAoC,GAC7C;oBAAE,QAAQ;gBAAI;YAElB;QACF;QAEA,sBAAsB;QACtB,MAAM,KAAK,IAAA,6IAAU;QACrB,MAAM,UAAU,OAAO,WAAW,CAAC,QAAQ,OAAO,CAAC,OAAO;QAC1D,MAAM,UAAU,QAAQ,GAAG,CAAC,QAAQ,IACrB,CAAC,OAAO,CAAC,oBAAoB,IAAI,MAAM,IAAI,QAAQ,QAAQ,IAAI,IAC/D;QACf,MAAM,MAAM,GAAG,QAAQ,GAAG,EAAE,IAAI;QAEhC,wBAAwB;QACxB,MAAM,MAAM,IAAA,iJAAc;QAC1B,MAAM,YAAY,cACd,IAAI,KAAK,MAAM,cAAc,MAAM,WAAW,KAC9C;QAEJ,mBAAmB;QACnB,MAAM,YAAY;YAChB,SAAS,QAAQ,IAAI;YACrB,WAAW;YACX;YACA,UAAU,aAAa;YACvB,cAAc;QAChB;QAEA,cAAc;QACd,MAAM,IAAA,4IAAS,EAAC,IAAI,WAAW;QAE/B,OAAO,SAAS,IAAI,CAAC;YAAE;YAAI;QAAI,GAAG;YAAE,QAAQ;QAAI;IAClD,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,yBAAyB;QACvC,OAAO,SAAS,IAAI,CAClB;YAAE,OAAO;QAAwB,GACjC;YAAE,QAAQ;QAAI;IAElB;AACF"}}]
}